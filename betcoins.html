<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>BetCoins Demo Chart</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
  
  <canvas id="chart" style="max-height: 90vh;max-width: 90vw;"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@1.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-streaming@latest/dist/chartjs-plugin-streaming.min.js"></script>
  <script src="https://js.pusher.com/5.0/pusher.min.js"></script>

  <script type="text/javascript">
    var ctx = document.getElementById('chart').getContext('2d');
    var pusher = new Pusher('de504dc5763aeef9ff52'); // Pusher key for Bitstamp
    var channel = pusher.subscribe('live_trades'); // subscribe live trade data
    var chart = new Chart(ctx, {
        type: 'line',
        data: {
            datasets: [{
                data: [],
                label: 'Buy',                    
                borderColor: 'rgb(255, 99, 132)', 
                backgroundColor: 'rgba(255, 99, 132, 0.5)', 
                fill: false,                    
                lineTension: 0                   
            }]
        },
        options: {
            title: {
                text: 'BTC/USD',
                display: true
            },
            scales: {
                xAxes: [{
                    type: 'realtime' 
                }]
            },
            plugins: {
                streaming: {
                    duration: 30000, 
                    frameRate: 30
                }
            }
        }
    })

    channel.bind('trade', function (data) { // callback on message receipt
        console.log(data)

        // append the new data to the existing chart data
        chart.data.datasets[0].data.push({
            x: data.timestamp * 1000,
            y: data.price
        });

        // update chart datasets keeping the current animation
        chart.update({
            preservation: true
        });
    });
  </script>
</body>

</html>